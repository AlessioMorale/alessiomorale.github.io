{"componentChunkName":"component---src-templates-blog-post-js","path":"/2021-03-22-creating-docker-images-for-jetson-nano-on-your-desktop/","result":{"data":{"site":{"siteMetadata":{"title":"A*Morale","author":"Alessio Morale","siteUrl":"https://blog.alessiomorale.com"}},"markdownRemark":{"id":"4bb35323-831c-5735-be96-bf293050b138","excerpt":"In this article I will show the workflow I’m using to be able to build Docker containers to be deployed on a Jetson Nano using my desktop machine. Rationale…","html":"<p>In this article I will show the workflow I’m using to be able to build Docker containers to be deployed on a Jetson Nano using my desktop machine.</p>\n<ul>\n<li><a href=\"#rationale\">Rationale</a></li>\n<li><a href=\"#qemu\">QEMU</a></li>\n<li><a href=\"#build-images-for-aarch64\">Build images for aarch64</a></li>\n<li><a href=\"#issues\">Issues</a></li>\n<li><a href=\"#whats-next\">What’s next</a></li>\n</ul>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fcb74c3850e703ed754f05e7bb58ae04/f8e5b/IMG_20210321_235444.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin: 7vw 0; max-width: 1360px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 69.11764705882352%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEBf/EABYBAQEBAAAAAAAAAAAAAAAAAAEAAv/aAAwDAQACEAMQAAABldKmds1Bz//EABkQAAIDAQAAAAAAAAAAAAAAAAECAxESBP/aAAgBAQABBQJJBRXRiR2XGglzdAFD/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAHRAAAgICAwEAAAAAAAAAAAAAAAECETFBImGRof/aAAgBAQAGPwLFLQqdSf014SlDjWexW8lI/8QAGhABAAMBAQEAAAAAAAAAAAAAAQARIUExYf/aAAgBAQABPyFl30gH1+svQXkp2nZeVG9LDFERPIJNDjOE5wE//9oADAMBAAIAAwAAABCw3//EABcRAAMBAAAAAAAAAAAAAAAAAAABESH/2gAIAQMBAT8Qbwh//8QAFhEBAQEAAAAAAAAAAAAAAAAAABEh/9oACAECAQE/EJqv/8QAHhABAAEEAgMAAAAAAAAAAAAAAREAITFBUXFhgfD/2gAIAQEAAT8QfjmAjATm2d+Cr8sUkoZGlk9UnjqAZju01yNOJJLBr7FBmUBsAMHBBFGLtj3X/9k='); background-size: cover; display: block;\"\n    >\n      <picture>\n        <source\n          srcset=\"/static/fcb74c3850e703ed754f05e7bb58ae04/51a8e/IMG_20210321_235444.webp 340w,\n/static/fcb74c3850e703ed754f05e7bb58ae04/713b7/IMG_20210321_235444.webp 680w,\n/static/fcb74c3850e703ed754f05e7bb58ae04/54376/IMG_20210321_235444.webp 1360w,\n/static/fcb74c3850e703ed754f05e7bb58ae04/0be89/IMG_20210321_235444.webp 2040w,\n/static/fcb74c3850e703ed754f05e7bb58ae04/71194/IMG_20210321_235444.webp 2720w,\n/static/fcb74c3850e703ed754f05e7bb58ae04/b4fca/IMG_20210321_235444.webp 3112w\"\n          sizes=\"(max-width: 1360px) 100vw, 1360px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/fcb74c3850e703ed754f05e7bb58ae04/2e524/IMG_20210321_235444.jpg 340w,\n/static/fcb74c3850e703ed754f05e7bb58ae04/d330d/IMG_20210321_235444.jpg 680w,\n/static/fcb74c3850e703ed754f05e7bb58ae04/6c26c/IMG_20210321_235444.jpg 1360w,\n/static/fcb74c3850e703ed754f05e7bb58ae04/afd2d/IMG_20210321_235444.jpg 2040w,\n/static/fcb74c3850e703ed754f05e7bb58ae04/f4749/IMG_20210321_235444.jpg 2720w,\n/static/fcb74c3850e703ed754f05e7bb58ae04/f8e5b/IMG_20210321_235444.jpg 3112w\"\n          sizes=\"(max-width: 1360px) 100vw, 1360px\"\n          type=\"image/jpeg\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n          src=\"/static/fcb74c3850e703ed754f05e7bb58ae04/6c26c/IMG_20210321_235444.jpg\"\n          alt=\"Jetson Nano\"\n          title=\"\"\n          src=\"/static/fcb74c3850e703ed754f05e7bb58ae04/6c26c/IMG_20210321_235444.jpg\"\n        />\n      </picture>\n      </span>\n  </span>\n  \n  </a>\n    </p>\n<h2>Rationale</h2>\n<p>For some time I was looking at a simple, repeatable solution to deploy my ROS robot software on clean Jetson Nano/Jetpack installation. Wishing to use CUDA enabled version of the various packages where this is available also meant a lot of recompilation effort.\nFor this reason I searched for a solution to prepare them off-board, either on a desktop pc or even better using CI with Github/Gitlab.</p>\n<h2>QEMU</h2>\n<p>The first issue is the difference in architecture between the desktop machine (a common <a href=\"https://en.wikipedia.org/wiki/X86-64\">x86-64/AMD64</a> machine) and the target machine, an <a href=\"https://en.wikipedia.org/wiki/AArch64\">AArch64</a> cpu. Obviously Arm code cannot run on a x86/amd64 thus we need to use some kind of emulation in place.</p>\n<p>Fortunately there is a very nice tool that can came to the rescue, it is <a href=\"https://www.qemu.org/\">QEMU</a>.</p>\n<p>To install qemu and setup it to run aarch64 code on your machine you need to run the following instructions. the first will install qemu and its prerequisite while the second line register qemu to be able to run aarch64 code using the emulation.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># Configure aarch64 emulation</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> qemu binfmt-support qemu-user-static <span class=\"token comment\"># Install the qemu packages</span>\ndocker run --rm --privileged multiarch/qemu-user-static --reset -p <span class=\"token function\">yes</span> <span class=\"token comment\"># This step will execute the registering scripts</span></code></pre></div>\n<p>At this point you will be able to run any AArch64 code in your machine. This include docker images as well.</p>\n<p>You can test that everything is set up properly by trying to run a aarch64 <code class=\"language-text\">hello world</code></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker run --rm arm64v8/hello-world:linux</code></pre></div>\n<p>If this shows you a (particularly long) hello world message then your installation is successful.</p>\n<h2>Build images for aarch64</h2>\n<p>The good news is that at this point you can not only run container images for aarch64 but also build new images.</p>\n<p>Obviously the most important thing to take into account is to chose aarch64 images as base images for your docker containers.</p>\n<p>If you are going to run on a Jetson (Nano but the same applies to the other Jetsons as well). For additional informations you can look at the <a href=\"https://developer.nvidia.com/embedded/jetson-cloud-native\">Cloud native on Jetson</a> page. In that case you want to use one of the various version of the <code class=\"language-text\">nvcr.io/nvidia/l4t-base</code> image.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8e0bcfed719e21f05be97bf4714c730b/ea415/htop.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin: 7vw 0; max-width: 1000px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 30%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABPklEQVQY002O2W7CQAxF8ymZzJJtJhshYYeCaJ8QoC70tRKlIS1F8P/SrUlR6cORPfbR9VicC3CuwB0OhzEwwnGcPzjnEIKcC9Qz9jtzXfeKujlULT8wCOMWdKrhax9S0eIaZts2PM+HMeREMUymERgfXkBBhPQklCshuIMoihrX0lELppUSl+CQZA9SXn8kOOJYI0kS6KSNuMgQt6nPYoSJpjAFZl8OMxhtoJQLKzAari/oGocipOs0VSjeXE8SF6Em0pwCS2RlAT/S5AtyGLj8h7BhLbZvWFbveDzUWNcVVvsPYof1vsZie8ZyXzXvVbXD03eN5+MnXo41NucDNqevWz0d8Eq9NZ7M0BuMkOUF8u4AaX+GfDjHaDpHl+Zl2cV4MsWIvNn8AXeze3R6Q6Tkt2lXdvpNzYsOzQf4AaUMwdRXRQEhAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <picture>\n        <source\n          srcset=\"/static/8e0bcfed719e21f05be97bf4714c730b/51a8e/htop.webp 340w,\n/static/8e0bcfed719e21f05be97bf4714c730b/713b7/htop.webp 680w,\n/static/8e0bcfed719e21f05be97bf4714c730b/d0dac/htop.webp 1000w\"\n          sizes=\"(max-width: 1000px) 100vw, 1000px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/8e0bcfed719e21f05be97bf4714c730b/ad208/htop.png 340w,\n/static/8e0bcfed719e21f05be97bf4714c730b/a5a26/htop.png 680w,\n/static/8e0bcfed719e21f05be97bf4714c730b/ea415/htop.png 1000w\"\n          sizes=\"(max-width: 1000px) 100vw, 1000px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n          src=\"/static/8e0bcfed719e21f05be97bf4714c730b/ea415/htop.png\"\n          alt=\"htop\"\n          title=\"\"\n          src=\"/static/8e0bcfed719e21f05be97bf4714c730b/ea415/htop.png\"\n        />\n      </picture>\n      </span>\n  </span>\n  \n  </a>\n    </p>\n<h2>Issues</h2>\n<p>The biggest issue with this approach is that the emulation is slow compared to a native execution. This is especially true for activities like code compilation. Thus it will probably take more time than if it was done onboard.</p>\n<p>As a partial workaround I used <a href=\"https://ccache.dev/\">ccache</a> to be able to reuse as much as possible the compilation work done for previous builds. Obviously you have to download and upload to some form of online storage the cache content during the build process. Initialy I implemented this process using bintray but I’ m now moving to some simple git repository.</p>\n<p>You can have a look at <a href=\"https://github.com/AlessioMorale/jetson-ros-perception/blob/f219b7ac7fd1cbe24b7b951198c5ff273fcd291a/Dockerfile#L21\">this approach</a>. For this to work I have to use BUILDKIT as it allows to use build time secrets that are not shipped inside the destination container (this would not be otherwise possible with the standard docker build as your storage secrets would be left in clear in the result container).</p>\n<h2>What’s next</h2>\n<p>This was just a little introduction on this topic. In the next articles we will dig a bit further in this topic analysing how can we build images using a GitHub Actions, and what are the things to take into account when building CUDA code on a different architecture than the runtime environment.</p>","frontmatter":{"title":"Building Docker images for Jetson Nano on your desktop","tags":["arm","docker","NVidia","arm64","Jetson nano","qemu","slammer"],"date":"March 22, 2021","description":null,"thumbnail":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEBf/EABYBAQEBAAAAAAAAAAAAAAAAAAEAAv/aAAwDAQACEAMQAAABldKmds1Bz//EABkQAAIDAQAAAAAAAAAAAAAAAAECAxESBP/aAAgBAQABBQJJBRXRiR2XGglzdAFD/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAHRAAAgICAwEAAAAAAAAAAAAAAAECETFBImGRof/aAAgBAQAGPwLFLQqdSf014SlDjWexW8lI/8QAGhABAAMBAQEAAAAAAAAAAAAAAQARIUExYf/aAAgBAQABPyFl30gH1+svQXkp2nZeVG9LDFERPIJNDjOE5wE//9oADAMBAAIAAwAAABCw3//EABcRAAMBAAAAAAAAAAAAAAAAAAABESH/2gAIAQMBAT8Qbwh//8QAFhEBAQEAAAAAAAAAAAAAAAAAABEh/9oACAECAQE/EJqv/8QAHhABAAEEAgMAAAAAAAAAAAAAAREAITFBUXFhgfD/2gAIAQEAAT8QfjmAjATm2d+Cr8sUkoZGlk9UnjqAZju01yNOJJLBr7FBmUBsAMHBBFGLtj3X/9k=","aspectRatio":1.446808510638298,"src":"/static/fcb74c3850e703ed754f05e7bb58ae04/ac53a/IMG_20210321_235444.jpg","srcSet":"/static/fcb74c3850e703ed754f05e7bb58ae04/722c4/IMG_20210321_235444.jpg 340w,\n/static/fcb74c3850e703ed754f05e7bb58ae04/1d671/IMG_20210321_235444.jpg 680w,\n/static/fcb74c3850e703ed754f05e7bb58ae04/ac53a/IMG_20210321_235444.jpg 1360w,\n/static/fcb74c3850e703ed754f05e7bb58ae04/6eda9/IMG_20210321_235444.jpg 2040w,\n/static/fcb74c3850e703ed754f05e7bb58ae04/eb7b7/IMG_20210321_235444.jpg 2720w,\n/static/fcb74c3850e703ed754f05e7bb58ae04/3a051/IMG_20210321_235444.jpg 3112w","sizes":"(max-width: 1360px) 100vw, 1360px"}}}}}},"pageContext":{"slug":"/2021-03-22-creating-docker-images-for-jetson-nano-on-your-desktop/","previous":{"fields":{"slug":"/2020-06-11-sensors-and-multifunctional-light-for-slammer/"},"frontmatter":{"title":"Sensors and multifunctional light for Slammer","tags":["robot","ROS","slammer","unav","una22"]}},"next":{"fields":{"slug":"/slammer/"},"frontmatter":{"title":"Slammer","tags":["robot","ROS","slammer","uNav","uNav2","RTabMap"]}}}},"staticQueryHashes":["63159454"]}